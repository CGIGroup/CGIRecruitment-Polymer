<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-datatable/paper-datatable.html">
<link rel="import" href="../bower_components/paper-datatable/paper-datatable-column.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/polymerfire/polymerfire.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../bower_components/granite-file-saver/granite-file-saver.html">
<link rel="import" href="shared-styles.html">

<dom-module id="cgi-candidates">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
                height: 100%;
                position: relative;
                overflow-y: auto;
                padding: 10px;
            }
            paper-button {
                background: #ac3535;
                color: white;
            }
        </style>

        <firebase-query
                id = "query"
                path = "/candidates"
                data = "{{data}}">
        </firebase-query>

        <paper-button on-tap="deleteRow" disabled="[[!selectedItem]]">Delete Candidate</paper-button>
        <granite-file-saver
                filename="[[computeFilename()]]"
                payload="[[computeCsv()]]">
            <paper-button>Export</paper-button>
        </granite-file-saver>

        <paper-datatable data="{{data}}" selected-item="{{selectedItem}}" selectable>
            <paper-datatable-column
                    header="Voornaam"
                    property="firstName"
                    type="String"
                    sortable
                    editable>
            </paper-datatable-column>

            <paper-datatable-column
                    header="Achternaam"
                    property="lastName"
                    type="String"
                    sortable
                    editable>
            </paper-datatable-column>

            <!--<paper-datatable-column
                    header="Geslacht"
                    property="sex"
                    type="String"
                    sortable
                    editable>
            </paper-datatable-column>-->

            <paper-datatable-column
                    header="Nederlands"
                    property="dutch"
                    type="Boolean"
                    sortable
                    editable>
            </paper-datatable-column>

            <paper-datatable-column
                    header="Engels"
                    property="english"
                    type="Boolean"
                    sortable
                    editable>
            </paper-datatable-column>

            <paper-datatable-column
                    header="Telefoonnummer"
                    property="telno"
                    type="String"
                    sortable
                    editable>
            </paper-datatable-column>

            <paper-datatable-column
                    header="Email-adres"
                    property="email"
                    type="String"
                    sortable
                    editable>
            </paper-datatable-column>

            <paper-datatable-column
                    header="LinkedIn URL"
                    property="linkedinUrl"
                    type="String"
                    sortable
                    editable>
            </paper-datatable-column>

            <paper-datatable-column
                    header="Hoogste Kwalificatie"
                    property="highestQualification"
                    type="String"
                    sortable
                    editable>
            </paper-datatable-column>

            <paper-datatable-column
                    header="Afstudeer Datum"
                    property="graduationDate"
                    type="Date"
                    sortable
                    editable>
            </paper-datatable-column>

            <paper-datatable-column
                    header="Gecertificeerd"
                    property="certified"
                    type="Boolean"
                    sortable
                    editable>
            </paper-datatable-column>

            <paper-datatable-column
                    header="Certificaat"
                    property="certificate"
                    type="String"
                    sortable
                    editable>
            </paper-datatable-column>

            <paper-datatable-column
                    header="Huidige Rol"
                    property="currentRole"
                    type="String"
                    sortable
                    editable>
            </paper-datatable-column>

            <paper-datatable-column
                    header="Rol Geintresseerd"
                    property="preferredRole"
                    type="String"
                    sortable
                    editable>
            </paper-datatable-column>

            <paper-datatable-column
                    header="Voorkeur Locatie"
                    property="preferredLocation"
                    type="String"
                    sortable
                    editable>
            </paper-datatable-column>

            <paper-datatable-column
                    header="Voorkeur Sector"
                    property="preferredSector"
                    type="String"
                    sortable
                    editable>
            </paper-datatable-column>

            <paper-datatable-column
                    header="Vaardigheden"
                    property="skills"
                    type="String"
                    sortable
                    editable>
            </paper-datatable-column>

            <paper-datatable-column
                    header="Contact Persoon"
                    property="contact"
                    type="String"
                    sortable
                    editable>
            </paper-datatable-column>

            <paper-datatable-column
                    header="Groep"
                    property="group"
                    type="String"
                    sortable
                    editable>
            </paper-datatable-column>

            <paper-datatable-column
                    header="Opmerkingen"
                    property="remarks"
                    type="String"
                    sortable
                    editable>
            </paper-datatable-column>

            <paper-datatable-column
                    header="Privacy Disclaimer"
                    property="disclaimer"
                    type="Boolean"
                    sortable
                    editable>
            </paper-datatable-column>

            <paper-datatable-column
                    header="Nieuwsbrief"
                    property="newsLetter"
                    type="Boolean"
                    sortable
                    editable>
            </paper-datatable-column>

            <!--<paper-datatable-column
                    header="Gebruiker"
                    property="user"
                    type="String"
                    sortable
                    editable>
            </paper-datatable-column>-->

            <paper-datatable-column
                    header="Event"
                    property="event"
                    type="String"
                    sortable
                    editable>
            </paper-datatable-column>
        </paper-datatable>
        <br>
        <br>
    </template>
    <script>
        Polymer({
            is: 'cgi-candidates',
            properties:{
                data: {
                    type: Array,
                    value: function(){return [];},
                    observer: 'dataChanged'
                },
                event:{
                    type: String,
                    value: ''
                },
                user:{
                    type: String,
                    value: ''
                },
                selectedItem: {
                    value: null
                }
            },
            deleteRow: function(e){
                var key = this.selectedItem.$key;
                firebase.database().ref('/candidates/' + key).remove();
            },
            computeFilename: function(){
                var dateStr = new Date().toLocaleDateString();
                return "candidates-"+dateStr+".csv";
            },
            computeCsv: function(){
                //payload='[ "\"The content\"; 324324,5465;\"to save\";\n","\"The content\"; \"to save\";\n"]'
                //https://cgirecruitment-389df.firebaseio.com/.json?print=pretty&format=export&download=cgirecruitment-389df-export.json&auth=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE0OTI2MTA0NjYsImV4cCI6MTQ5MjYxNDA2NiwiYWRtaW4iOnRydWUsInYiOjB9.fkgub8y-HNi38QIk-w4QGXCIAKjABEEipg2ONrFfFn8
                var result = [];
                result.push(
                        '\"First Name\";'+
                        '\"Last Name\";'+
                        '\"Dutch\";'+
                        '\"English\";'+
                        '\"Telno\";'+
                        '\"Email\";'+
                        '\"Linkedin Url\";'+
                        '\"Highest Qualification\";'+
                        '\"Graduation Year\";'+
                        '\"Certified\";'+
                        '\"Certificate\";'+
                        '\"Huidige Rol\";'+
                        '\"Preferred Role\";'+
                        '\"Preferred Location\";'+
                        '\"Preferred Sector\";'+
                        '\"Skills\";'+
                        '\"Contact\";'+
                        '\"Group\";'+
                        '\"Remarks\";'+
                        '\"Disclaimer\";'+
                        '\"NewsLetter\";'+
                        '\"Event\";'+
                        '\n'
                );
                if(this.data) this.data.forEach(function(row){
                    result.push(
                            '\"'+row.firstName+'\";'+
                            '\"'+row.lastName+'\";'+
                            '\"'+row.dutch+'\";'+
                            '\"'+row.english+'\";'+
                            '\"'+row.telno+'\";'+
                            '\"'+row.email+'\";'+
                            '\"'+row.linkedinUrl+'\";'+
                            '\"'+row.highestQualification+'\";'+
                            '\"'+row.graduationYear+'\";'+
                            '\"'+row.certified+'\";'+
                            '\"'+row.certificate+'\";'+
                            '\"'+row.currentRole+'\";'+
                            '\"'+row.preferredRole+'\";'+
                            '\"'+row.preferredLocation+'\";'+
                            '\"'+row.preferredSector+'\";'+
                            '\"'+row.skills+'\";'+
                            '\"'+row.contact+'\";'+
                            '\"'+row.group+'\";'+
                            '\"'+row.remarks+'\";'+
                            '\"'+row.disclaimer+'\";'+
                            '\"'+row.newsLetter+'\";'+
                            '\"'+row.event+'\";'+
                            '\n'
                    );
                });
                return result
            }
        });
    </script>

</dom-module>
