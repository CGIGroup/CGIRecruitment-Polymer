<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-datatable/paper-datatable.html">
<link rel="import" href="../bower_components/paper-datatable/paper-datatable-column.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/polymerfire/polymerfire.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="shared-styles.html">

<dom-module id="cgi-users">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
                height: 100%;
                position: relative;
                overflow-y: auto;
                padding: 10px;
            }
            paper-button {
                background: #ac3535;
                color: white;
            }
        </style>

        <firebase-query
                id = "query"
                path = "/users"
                data = "{{data}}">
        </firebase-query>

        <paper-button on-tap="addRow">Add User</paper-button>
        <paper-button on-tap="deleteRow" disabled="[[!selectedItem]]">Delete User</paper-button>

        <paper-datatable data="{{data}}" selected-item="{{selectedItem}}" selectable>
            <paper-datatable-column header="Name" property="displayName" sortable type="String" editable></paper-datatable-column>
            <paper-datatable-column header="Email" property="email" sortable type="String" editable></paper-datatable-column>
            <paper-datatable-column header="Admin" property="admin" sortable type="Boolean" editable></paper-datatable-column>
        </paper-datatable>

        <br>
        <br>

    </template>

    <script>
        Polymer({
            is: 'cgi-users',
            properties:{
                data: {
                    type: Array,
                    value: [],
                    observer: 'dataChanged'
                },
                selectedItem: {
                    value: null
                }
            },

            addRow: function(e){
                var newUser = {
                    displayName:"",
                    email:"@cgi.com",
                    admin:false
                };
                this.$.query.ref.push(newUser);
            },

            deleteRow: function(e){
                var key = this.selectedItem.$key;
                firebase.database().ref('/users/' + key).remove();
                // for some reason this does not work. See Polycast #58
                //this.$.query.child(key).remove();
            },

            dataChanged: function(newValue, oldValue) {
                console.log('data:', oldValue, 'to', newValue);
            }
        });
    </script>
</dom-module>
